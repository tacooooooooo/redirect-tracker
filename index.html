<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webhook and Link Generator</title>
</head>
<body>
    <h1>Webhook and URL Encoder</h1>

    <!-- Input form for Webhook URL and Redirect URL -->
    <form id="form">
        <label for="webhook">Webhook URL:</label><br>
        <input type="text" id="webhook" name="webhook" required><br><br>

        <label for="link">Redirect URL:</label><br>
        <input type="text" id="link" name="link" required><br><br>

        <button type="submit">Generate Link</button>
    </form>

    <!-- Display the generated link -->
    <h2>Generated Link:</h2>
    <p id="generatedLink"></p>

    <script>
        // Base64 encode a string
        function base64Encode(str) {
            return btoa(unescape(encodeURIComponent(str)));
        }

        // Base64 decode a string
        function base64Decode(str) {
            return decodeURIComponent(escape(atob(str)));
        }

        // Event listener to generate the link
        document.getElementById("form").addEventListener("submit", function(event) {
            event.preventDefault();

            const webhook = document.getElementById("webhook").value;
            const link = document.getElementById("link").value;

            // Encode Webhook and Link into Base64
            const encodedWebhook = base64Encode(webhook);
            const encodedLink = base64Encode(link);

            // Generate the relative URL with encoded parameters
            const generatedUrl = `?w=${encodedWebhook}&l=${encodedLink}`;

            // Display the generated link (relative to current site)
            document.getElementById("generatedLink").innerHTML = `<a href="${generatedUrl}" target="_blank">${generatedUrl}</a>`;
        });

        // Check if the page is loaded with parameters
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const encodedWebhook = urlParams.get('w');
            const encodedLink = urlParams.get('l');

            if (encodedWebhook && encodedLink) {
                // Decode Webhook and Link
                const webhook = base64Decode(encodedWebhook);
                const link = base64Decode(encodedLink);

                // Send 'test' data to the webhook via a POST request
                fetch(webhook, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: "test" }),
                }).then(response => {
                    console.log('Webhook sent:', response);
                }).catch(error => {
                    console.error('Error sending webhook:', error);
                });

                // Redirect to the decoded link
                window.location.href = link;
            }
        };
    </script>
</body>
</html>
